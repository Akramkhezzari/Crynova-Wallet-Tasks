<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Crynova</title>
  
  <!-- Ø¥Ø¶Ø§ÙØ© Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  
  <!-- Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #0072ff;
      --secondary: #ff2d9e;
      --accent: #7d3dff;
      --danger: #ff4757;
      --success: #26a17b;
      --warning: #ff9f00;
      --info: #2d87ff;
      --bg-light: #ffffff;
      --bg-lighter: #f8f9fa;
      --text-dark: #1a1a1a;
      --text-gray: #666;
      --text-light: #888;
      --border-light: rgba(0, 0, 0, 0.1);
      --shadow-light: rgba(0, 0, 0, 0.08);
      --chart-up: #26a17b;
      --chart-down: #ff4757;
    }

    body {
      background: #ffffff;
      color: var(--text-dark);
      min-height: 100vh;
      padding: 0;
    }

    /* ========== Ø¥Ø·Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
    .page-frame {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      background: #ffffff;
      overflow: hidden;
      position: relative;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* ========== Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© ========== */
    .page-header {
      background: linear-gradient(135deg, var(--accent), var(--primary));
      color: white;
      padding: 25px 15px 20px;
      text-align: center;
      position: relative;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0, 114, 255, 0.3);
    }

    .page-header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 8px;
      margin-top: 0;
    }

    .page-header p {
      opacity: 0.9;
      font-size: 0.9rem;
      margin-bottom: 0;
    }

    .page-back-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 11;
    }

    .page-back-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-50%) scale(1.1);
    }

    /* ========== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© ========== */
    .page-content {
      padding: 15px;
    }

    /* ========== Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… ========== */
    .tasks-section {
      margin-bottom: 25px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title i {
      color: var(--primary);
    }

    /* ========== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ========== */
    .tasks-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .task-item {
      background: #ffffff;
      border-radius: 12px;
      padding: 15px;
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .task-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }

    .task-item.completed {
      background: linear-gradient(135deg, rgba(38, 161, 123, 0.05), rgba(38, 161, 123, 0.1));
      border-color: rgba(38, 161, 123, 0.2);
    }

    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .task-title {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
      flex: 1;
    }

    .task-reward {
      background: linear-gradient(135deg, var(--warning), #ffcc00);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .task-reward i {
      font-size: 10px;
    }

    .task-description {
      font-size: 12px;
      color: var(--text-gray);
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .task-progress {
      margin-bottom: 12px;
    }

    .progress-bar {
      height: 6px;
      background: #e9ecef;
      border-radius: 3px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    .progress-text {
      font-size: 10px;
      color: var(--text-light);
      text-align: left;
      margin-top: 4px;
    }

    .task-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .task-status {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 600;
    }

    .task-status.pending {
      background: rgba(255, 159, 0, 0.1);
      color: var(--warning);
      border: 1px solid rgba(255, 159, 0, 0.2);
    }

    .task-status.in-progress {
      background: rgba(0, 114, 255, 0.1);
      color: var(--primary);
      border: 1px solid rgba(0, 114, 255, 0.2);
    }

    .task-status.completed {
      background: rgba(38, 161, 123, 0.1);
      color: var(--success);
      border: 1px solid rgba(38, 161, 123, 0.2);
    }

    .task-action-btn {
      padding: 8px 15px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .task-action-btn.claim {
      background: linear-gradient(90deg, var(--success), #1bc48b);
      color: white;
      box-shadow: 0 2px 8px rgba(38, 161, 123, 0.2);
    }

    .task-action-btn.claim:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(38, 161, 123, 0.3);
    }

    .task-action-btn.start {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 2px 8px rgba(0, 114, 255, 0.2);
    }

    .task-action-btn.start:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 114, 255, 0.3);
    }

    .task-action-btn:disabled {
      background: #e9ecef;
      color: var(--text-light);
      cursor: not-allowed;
      box-shadow: none;
    }

    .task-action-btn:disabled:hover {
      transform: none;
      box-shadow: none;
    }

    /* ========== Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ========== */
    .achievements-section {
      margin-bottom: 25px;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .achievement-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      border: 1px solid transparent;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .achievement-card:hover {
      background: #ffffff;
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow-light);
    }

    .achievement-card.locked {
      opacity: 0.7;
    }

    .achievement-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      color: white;
      font-size: 20px;
    }

    .achievement-icon.locked {
      background: linear-gradient(135deg, #adb5bd, #6c757d);
    }

    .achievement-title {
      font-weight: 700;
      font-size: 12px;
      color: var(--text-dark);
      margin-bottom: 5px;
    }

    .achievement-desc {
      font-size: 10px;
      color: var(--text-light);
    }

    /* ========== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ========== */
    .tasks-info {
      background: var(--bg-lighter);
      border-radius: 12px;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid var(--border-light);
    }

    .info-title {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .info-item {
      padding: 8px 0;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-item i {
      color: var(--primary);
      font-size: 14px;
      margin-top: 2px;
    }

    .info-text {
      font-size: 12px;
      color: var(--text-gray);
      line-height: 1.5;
    }

    /* ========== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª ========== */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #ffffff;
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0, 0, 0, 0.08);
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      z-index: 1000;
      gap: 5px;
      max-width: 800px;
      margin: 0 auto;
      border-radius: 25px 25px 0 0;
      border-left: 1px solid rgba(0, 0, 0, 0.05);
      border-right: 1px solid rgba(0, 0, 0, 0.05);
      height: 60px;
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 6px 8px;
      border-radius: 16px;
      cursor: pointer;
      text-decoration: none;
      min-width: 70px;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
      background: transparent;
      height: 52px;
    }

    .bottom-nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(0, 114, 255, 0.05), rgba(255, 45, 158, 0.05));
      border-radius: 16px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .bottom-nav-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 114, 255, 0.1);
    }

    .bottom-nav-item.active {
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 6px 15px rgba(0, 114, 255, 0.15);
      transform: translateY(-3px);
      border: 1px solid rgba(0, 114, 255, 0.1);
    }

    .bottom-nav-item.active::before {
      opacity: 0.5;
    }

    .bottom-nav-text {
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      position: relative;
      z-index: 1;
      transition: all 0.3s ease;
      letter-spacing: 0.3px;
      background: linear-gradient(90deg, #0072ff, #ff2d9e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-top: 2px;
    }

    .bottom-nav-item:hover .bottom-nav-text {
      font-weight: 700;
      background: linear-gradient(90deg, #0052cc, #e61e8a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .bottom-nav-item.active .bottom-nav-text {
      font-weight: 800;
      font-size: 13px;
      background: linear-gradient(90deg, #0052cc, #e61e8a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 2px 4px rgba(0, 82, 204, 0.1);
    }

    .nav-icon {
      font-size: 18px;
      margin-bottom: 2px;
      position: relative;
      z-index: 1;
      background: linear-gradient(90deg, #0072ff, #ff2d9e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .bottom-nav-item.active .nav-icon {
      background: linear-gradient(90deg, #0052cc, #e61e8a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* ========== Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡Ø§Øª ========== */
    .loading-spinner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(0,114,255,0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--success);
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 90%;
      text-align: center;
      animation: slideDown 0.3s ease;
    }

    .toast-error {
      background: var(--danger);
    }

    .toast-warning {
      background: var(--warning);
    }

    @keyframes slideDown {
      from {
        transform: translateX(-50%) translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    /* ========== ØªØ¬Ø§ÙˆØ¨ÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ========== */
    @media (max-width: 480px) {
      .page-header {
        padding: 20px 15px 15px;
      }
      
      .page-header h1 {
        font-size: 1.3rem;
      }
      
      .achievements-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .bottom-nav {
        padding: 6px 0;
        height: 56px;
      }
      
      .bottom-nav-item {
        padding: 5px 6px;
        min-width: 60px;
        height: 48px;
        border-radius: 14px;
      }
      
      .bottom-nav-text {
        font-size: 10px;
      }
      
      .nav-icon {
        font-size: 16px;
      }
      
      .bottom-nav-item.active .bottom-nav-text {
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <!-- ========== Ø¥Ø·Ø§Ø± Ø§Ù„ØµÙØ­Ø© ========== -->
  <div class="page-frame">
    
    <!-- ========== Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© ========== -->
    <div class="page-header">
      <button class="page-back-btn" onclick="goBack()">&times;</button>
      <h1>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
      <p>Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ø±Ø¨Ø­ Ø¹Ù…Ù„Ø§Øª Crynova</p>
    </div>

    <!-- ========== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© ========== -->
    <div class="page-content">
      
      <!-- ========== Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ… ========== -->
      <div class="tasks-section">
        <div class="section-title">
          <i class="fas fa-tasks"></i>
          Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…
        </div>
        
        <div class="tasks-list" id="dailyTasksList">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>
      
      <!-- ========== Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ========== -->
      <div class="tasks-section">
        <div class="section-title">
          <i class="fas fa-calendar-week"></i>
          Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
        </div>
        
        <div class="tasks-list" id="weeklyTasksList">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>
      
      <!-- ========== Ù…Ù‡Ø§Ù… Ø®Ø§ØµØ© ========== -->
      <div class="tasks-section">
        <div class="section-title">
          <i class="fas fa-star"></i>
          Ù…Ù‡Ø§Ù… Ø®Ø§ØµØ©
        </div>
        
        <div class="tasks-list" id="specialTasksList">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>
      
      <!-- ========== Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ========== -->
      <div class="achievements-section">
        <div class="section-title">
          <i class="fas fa-trophy"></i>
          Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
        </div>
        
        <div class="achievements-grid" id="achievementsGrid">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>
      
      <!-- ========== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ========== -->
      <div class="tasks-info">
        <div class="info-title">
          <i class="fas fa-info-circle"></i>
          Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©
        </div>
        
        <ul class="info-list">
          <li class="info-item">
            <i class="fas fa-sync-alt"></i>
            <div class="info-text">ØªØªØ­Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„ (ØªÙˆÙ‚ÙŠØª ØºØ±ÙŠÙ†ØªØ´)</div>
          </li>
          <li class="info-item">
            <i class="fas fa-gift"></i>
            <div class="info-text">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ØªØ±Ø³Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ù‡Ø§</div>
          </li>
          <li class="info-item">
            <i class="fas fa-calendar-alt"></i>
            <div class="info-text">Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ØªÙØ¹Ø§Ø¯ Ø¥Ø°Ø§ ÙØ§ØªÙƒ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</div>
          </li>
          <li class="info-item">
            <i class="fas fa-bolt"></i>
            <div class="info-text">Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… ØªØªØ·Ù„Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ù…Ù‡Ø§Ù… Ø³Ø§Ø¨Ù‚Ø© Ù„ÙØªØ­Ù‡Ø§</div>
          </li>
        </ul>
      </div>
      
    </div>
  </div>

  <!-- ========== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª ========== -->
  <div class="bottom-nav" id="bottomNav">
    <a href="https://akramkhezzari.github.io/Crynova-Wallet/" class="bottom-nav-item">
      <div class="nav-icon">ğŸ </div>
      <div class="bottom-nav-text">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    </a>
    
    <div class="bottom-nav-item active" data-page="tasks">
      <div class="nav-icon">âœ…</div>
      <div class="bottom-nav-text">Ø§Ù„Ù…Ù‡Ø§Ù…</div>
    </div>
    
    <a href="https://akramkhezzari.github.io/Crynova-Wallet-Referrals/" class="bottom-nav-item">
      <div class="nav-icon">ğŸ‘¥</div>
      <div class="bottom-nav-text">Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
    </a>
    
    <a href="https://akramkhezzari.github.io/Crynova-Wallet-Visa/" class="bottom-nav-item">
      <div class="nav-icon">ğŸ’³</div>
      <div class="bottom-nav-text">Visa</div>
    </a>
  </div>

  <!-- ========== Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== -->
  <div class="loading-spinner" id="loadingSpinner">
    <div class="spinner"></div>
  </div>

  <!-- ========== Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª JavaScript ========== -->
  <script>
    // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
    const firebaseConfig = {
      apiKey: "AIzaSyBX8v0qIVjG-Z46fVDeEUDKcPxa_FQF9Qc",
      authDomain: "bnak-belaiba.firebaseapp.com",
      projectId: "bnak-belaiba",
      storageBucket: "bnak-belaiba.firebasestorage.app",
      messagingSenderId: "286736432059",
      appId: "1:286736432059:web:ec1ed4292850f00008229e"
    };

    // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
    let db;
    try {
      const app = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      console.log('âœ… Firebase initialized successfully');
    } catch (error) {
      console.error('âŒ Firebase initialization error:', error);
    }

    // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
    let currentUser = {
      id: null,
      firstName: 'Ù…Ø³ØªØ®Ø¯Ù…',
      lastName: '',
      username: null
    };

    // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù… ==========
    let userTasks = {
      dailyTasks: [],
      weeklyTasks: [],
      specialTasks: [],
      achievements: []
    };

    // ========== Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… ==========
    const dailyTasksTemplates = [
      {
        id: 'daily_login',
        title: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ',
        description: 'Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ¢ØªÙƒ',
        reward: 10,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 1 },
        status: 'pending', // pending, in-progress, completed
        action: 'login',
        icon: 'fas fa-sign-in-alt'
      },
      {
        id: 'check_wallet',
        title: 'ÙØ­Øµ Ø§Ù„Ù…Ø­ÙØ¸Ø©',
        description: 'Ø§ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
        reward: 5,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 1 },
        status: 'pending',
        action: 'check_wallet',
        icon: 'fas fa-wallet'
      },
      {
        id: 'join_channel',
        title: 'Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù‚Ù†Ø§Ø©',
        description: 'Ø§Ù†Ø¶Ù… Ù„Ù‚Ù†Ø§Ø© Crynova Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø¹Ù„Ù‰ Telegram',
        reward: 20,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 1 },
        status: 'pending',
        action: 'join_channel',
        icon: 'fas fa-bullhorn'
      },
      {
        id: 'send_transaction',
        title: 'Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¹Ø§Ù…Ù„Ø©',
        description: 'Ø£Ø±Ø³Ù„ Ø£ÙŠ Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø±',
        reward: 25,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 1 },
        status: 'pending',
        action: 'send_transaction',
        icon: 'fas fa-paper-plane'
      }
    ];

    const weeklyTasksTemplates = [
      {
        id: 'complete_5_daily',
        title: 'Ø¥ÙƒÙ…Ø§Ù„ 5 Ù…Ù‡Ø§Ù… ÙŠÙˆÙ…ÙŠØ©',
        description: 'Ø£ÙƒÙ…Ù„ 5 Ù…Ù‡Ø§Ù… ÙŠÙˆÙ…ÙŠØ© Ù…Ø®ØªÙ„ÙØ© Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹',
        reward: 50,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 5 },
        status: 'pending',
        action: 'complete_daily',
        icon: 'fas fa-calendar-check'
      },
      {
        id: 'invite_3_friends',
        title: 'Ø¯Ø¹ÙˆØ© 3 Ø£ØµØ¯Ù‚Ø§Ø¡',
        description: 'Ø¯Ø¹ÙˆØ© 3 Ø£ØµØ¯Ù‚Ø§Ø¡ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Crynova',
        reward: 100,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 3 },
        status: 'pending',
        action: 'invite_friends',
        icon: 'fas fa-user-friends'
      },
      {
        id: 'trade_100_usdt',
        title: 'ØªØ¯Ø§ÙˆÙ„ Ø¨Ù‚ÙŠÙ…Ø© 100 USDT',
        description: 'Ù‚Ù… Ø¨Ø¹Ù…Ù„ÙŠØ§Øª ØªØ¯Ø§ÙˆÙ„ Ø¨Ù‚ÙŠÙ…Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© 100 USDT',
        reward: 75,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 100 },
        status: 'pending',
        action: 'trade_volume',
        icon: 'fas fa-chart-line'
      }
    ];

    const specialTasksTemplates = [
      {
        id: 'first_deposit',
        title: 'Ø£ÙˆÙ„ Ø¥ÙŠØ¯Ø§Ø¹',
        description: 'Ù‚Ù… Ø¨Ø£ÙˆÙ„ Ø¥ÙŠØ¯Ø§Ø¹ ÙÙŠ Ù…Ø­ÙØ¸ØªÙƒ',
        reward: 150,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 1 },
        status: 'pending',
        action: 'first_deposit',
        icon: 'fas fa-coins',
        oneTime: true
      },
      {
        id: 'first_trade',
        title: 'Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© ØªØ¯Ø§ÙˆÙ„',
        description: 'Ù‚Ù… Ø¨Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©',
        reward: 100,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 1 },
        status: 'pending',
        action: 'first_trade',
        icon: 'fas fa-exchange-alt',
        oneTime: true
      },
      {
        id: 'verify_account',
        title: 'ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨',
        description: 'Ø£ÙƒÙ…Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨',
        reward: 200,
        rewardCurrency: 'CNC',
        progress: { current: 0, target: 1 },
        status: 'pending',
        action: 'verify_account',
        icon: 'fas fa-user-check',
        oneTime: true
      }
    ];

    const achievementsTemplates = [
      {
        id: 'first_steps',
        title: 'Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰',
        description: 'Ø£ÙƒÙ…Ù„ Ø£ÙˆÙ„ Ù…Ù‡Ù…Ø©',
        reward: 50,
        rewardCurrency: 'CNC',
        icon: 'fas fa-walking',
        status: 'locked' // locked, unlocked, claimed
      },
      {
        id: 'task_master',
        title: 'Ø³ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù…',
        description: 'Ø£ÙƒÙ…Ù„ 10 Ù…Ù‡Ø§Ù…',
        reward: 100,
        rewardCurrency: 'CNC',
        icon: 'fas fa-tasks',
        status: 'locked'
      },
      {
        id: 'daily_king',
        title: 'Ù…Ù„Ùƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„',
        description: 'Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ 7 Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©',
        reward: 200,
        rewardCurrency: 'CNC',
        icon: 'fas fa-crown',
        status: 'locked'
      },
      {
        id: 'trader_novice',
        title: 'Ù…ØªØ¯Ø§ÙˆÙ„ Ù…Ø¨ØªØ¯Ø¦',
        description: 'Ù‚Ù… Ø¨Ù€ 5 Ø¹Ù…Ù„ÙŠØ§Øª ØªØ¯Ø§ÙˆÙ„',
        reward: 150,
        rewardCurrency: 'CNC',
        icon: 'fas fa-chart-bar',
        status: 'locked'
      },
      {
        id: 'social_butterfly',
        title: 'ÙØ±Ø§Ø´Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',
        description: 'Ø¯Ø¹ 5 Ø£ØµØ¯Ù‚Ø§Ø¡',
        reward: 250,
        rewardCurrency: 'CNC',
        icon: 'fas fa-users',
        status: 'locked'
      },
      {
        id: 'early_adopter',
        title: 'Ù…Ø¨ÙƒØ± ÙÙŠ Ø§Ù„ØªØ¨Ù†ÙŠ',
        description: 'Ø§Ù†Ø¶Ù… Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„',
        reward: 500,
        rewardCurrency: 'CNC',
        icon: 'fas fa-rocket',
        status: 'locked'
      }
    ];

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
    function showLoading(show) {
      const spinner = document.getElementById('loadingSpinner');
      if (spinner) {
        spinner.style.display = show ? 'flex' : 'none';
      }
    }

    function showToast(message, type = 'info') {
      const existingToasts = document.querySelectorAll('.toast');
      existingToasts.forEach(toast => toast.remove());
      
      const toast = document.createElement('div');
      toast.className = `toast ${type === 'error' ? 'toast-error' : type === 'warning' ? 'toast-warning' : ''}`;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        if (toast.parentNode) {
          toast.style.opacity = '0';
          toast.style.transition = 'opacity 0.3s ease';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.remove();
            }
          }, 300);
        }
      }, 3000);
    }

    function goBack() {
      window.history.back();
    }

    // ========== Ø¯ÙˆØ§Ù„ Firebase ==========
    async function initializeUserTasks(userId) {
      try {
        if (!db) {
          userTasks = {
            dailyTasks: JSON.parse(JSON.stringify(dailyTasksTemplates)),
            weeklyTasks: JSON.parse(JSON.stringify(weeklyTasksTemplates)),
            specialTasks: JSON.parse(JSON.stringify(specialTasksTemplates)),
            achievements: JSON.parse(JSON.stringify(achievementsTemplates))
          };
          return userTasks;
        }
        
        const tasksRef = db.collection('user_tasks').doc(userId.toString());
        const tasksDoc = await tasksRef.get();
        
        if (!tasksDoc.exists) {
          const tasksData = {
            userId: userId.toString(),
            dailyTasks: JSON.parse(JSON.stringify(dailyTasksTemplates)),
            weeklyTasks: JSON.parse(JSON.stringify(weeklyTasksTemplates)),
            specialTasks: JSON.parse(JSON.stringify(specialTasksTemplates)),
            achievements: JSON.parse(JSON.stringify(achievementsTemplates)),
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          
          await tasksRef.set(tasksData);
          userTasks = tasksData;
          return tasksData;
        } else {
          const tasksData = tasksDoc.data();
          userTasks = tasksData;
          
          return tasksData;
        }
      } catch (error) {
        console.error('âŒ Error initializing user tasks:', error);
        throw error;
      }
    }

    async function updateUserTasksInFirestore(userId, tasksData) {
      try {
        if (!db) {
          return false;
        }
        
        const tasksRef = db.collection('user_tasks').doc(userId.toString());
        await tasksRef.update({
          ...tasksData,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…', 'error');
        return false;
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
    function renderTaskList(tasks, containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;
      
      container.innerHTML = '';
      
      if (!tasks || tasks.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 20px; color: var(--text-light); font-size: 14px;">
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹
          </div>
        `;
        return;
      }
      
      tasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = `task-item ${task.status === 'completed' ? 'completed' : ''}`;
        taskElement.setAttribute('data-task-id', task.id);
        
        const progressPercent = task.progress.target > 0 ? 
          Math.min(100, (task.progress.current / task.progress.target) * 100) : 0;
        
        let actionButton = '';
        let statusText = '';
        
        switch(task.status) {
          case 'pending':
            statusText = 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
            break;
          case 'in-progress':
            statusText = 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°';
            break;
          case 'completed':
            statusText = 'Ù…ÙƒØªÙ…Ù„';
            break;
        }
        
        if (task.status === 'completed') {
          actionButton = `<button class="task-action-btn claim" onclick="claimReward('${task.id}')">
            <i class="fas fa-gift"></i>
            Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø©
          </button>`;
        } else if (task.status === 'in-progress') {
          actionButton = `<button class="task-action-btn start" onclick="startTask('${task.id}')">
            <i class="fas fa-play"></i>
            Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©
          </button>`;
        } else {
          actionButton = `<button class="task-action-btn start" onclick="startTask('${task.id}')" disabled>
            <i class="fas fa-lock"></i>
            Ù…Ù‚ÙÙ„Ø©
          </button>`;
        }
        
        taskElement.innerHTML = `
          <div class="task-header">
            <div class="task-title">${task.title}</div>
            <div class="task-reward">
              <i class="fas fa-coins"></i>
              ${task.reward} ${task.rewardCurrency}
            </div>
          </div>
          
          <div class="task-description">${task.description}</div>
          
          ${task.progress.target > 1 ? `
          <div class="task-progress">
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
            <div class="progress-text">${task.progress.current} / ${task.progress.target}</div>
          </div>
          ` : ''}
          
          <div class="task-footer">
            <div class="task-status ${task.status.replace('-', '')}">${statusText}</div>
            ${actionButton}
          </div>
        `;
        
        container.appendChild(taskElement);
      });
    }

    function renderAchievements() {
      const container = document.getElementById('achievementsGrid');
      if (!container) return;
      
      container.innerHTML = '';
      
      userTasks.achievements.forEach(achievement => {
        const achievementElement = document.createElement('div');
        achievementElement.className = `achievement-card ${achievement.status === 'locked' ? 'locked' : ''}`;
        achievementElement.setAttribute('data-achievement-id', achievement.id);
        
        achievementElement.innerHTML = `
          <div class="achievement-icon ${achievement.status === 'locked' ? 'locked' : ''}">
            <i class="${achievement.icon}"></i>
          </div>
          <div class="achievement-title">${achievement.title}</div>
          <div class="achievement-desc">${achievement.description}</div>
        `;
        
        container.appendChild(achievementElement);
      });
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ==========
    async function startTask(taskId) {
      showLoading(true);
      
      try {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        let task = null;
        let taskType = '';
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        task = userTasks.dailyTasks.find(t => t.id === taskId);
        if (task) taskType = 'daily';
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
        if (!task) {
          task = userTasks.weeklyTasks.find(t => t.id === taskId);
          if (task) taskType = 'weekly';
        }
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø®Ø§ØµØ©
        if (!task) {
          task = userTasks.specialTasks.find(t => t.id === taskId);
          if (task) taskType = 'special';
        }
        
        if (!task) {
          showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
          return;
        }
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„
        if (task.status === 'completed') {
          showToast('Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„', 'warning');
          return;
        }
        
        // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°
        task.status = 'in-progress';
        
        // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await updateUserTasksInFirestore(currentUser.id, userTasks);
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        renderTaskList(userTasks.dailyTasks, 'dailyTasksList');
        renderTaskList(userTasks.weeklyTasks, 'weeklyTasksList');
        renderTaskList(userTasks.specialTasks, 'specialTasksList');
        
        showToast('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
      } finally {
        showLoading(false);
      }
    }

    async function claimReward(taskId) {
      showLoading(true);
      
      try {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        let task = null;
        let taskType = '';
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        task = userTasks.dailyTasks.find(t => t.id === taskId);
        if (task) taskType = 'daily';
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
        if (!task) {
          task = userTasks.weeklyTasks.find(t => t.id === taskId);
          if (task) taskType = 'weekly';
        }
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø®Ø§ØµØ©
        if (!task) {
          task = userTasks.specialTasks.find(t => t.id === taskId);
          if (task) taskType = 'special';
        }
        
        if (!task) {
          showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©', 'error');
          return;
        }
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ù‡Ù…Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©
        if (task.status !== 'completed') {
          showToast('Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯', 'warning');
          return;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ ØªÙ… Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© (ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
        task.status = 'claimed';
        
        // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await updateUserTasksInFirestore(currentUser.id, userTasks);
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        renderTaskList(userTasks.dailyTasks, 'dailyTasksList');
        renderTaskList(userTasks.weeklyTasks, 'weeklyTasksList');
        renderTaskList(userTasks.specialTasks, 'specialTasksList');
        
        showToast(`Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${task.reward} ${task.rewardCurrency}`, 'success');
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©', 'error');
      } finally {
        showLoading(false);
      }
    }

    // ========== ØªÙ‡ÙŠØ¦Ø© Telegram WebApp ==========
    async function initializeTelegramWebApp() {
      try {
        if (window.Telegram && Telegram.WebApp) {
          const tg = Telegram.WebApp;
          
          tg.expand();
          tg.setBackgroundColor('#ffffff');
          
          const user = tg.initDataUnsafe.user;
          
          if (user && user.id) {
            console.log('ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Telegram:', user);
            
            currentUser = {
              id: user.id,
              firstName: user.first_name || 'Ù…Ø³ØªØ®Ø¯Ù…',
              lastName: user.last_name || '',
              username: user.username || null
            };
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¹Ù†ØµØ± Ù„Ø°Ù„Ùƒ
            const userNameElement = document.getElementById('userName');
            if (userNameElement) {
              userNameElement.textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù… Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            await initializeUserTasks(user.id);
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            renderTaskList(userTasks.dailyTasks, 'dailyTasksList');
            renderTaskList(userTasks.weeklyTasks, 'weeklyTasksList');
            renderTaskList(userTasks.specialTasks, 'specialTasksList');
            renderAchievements();
            
          } else {
            console.log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Telegram');
            useMockData();
          }
          
        } else {
          console.log('âŒ Telegram WebApp ØºÙŠØ± Ù…ØªÙˆÙØ±');
          useMockData();
        }
      } catch (error) {
        console.error('âŒ Telegram WebApp Error:', error);
        useMockData();
      }
    }

    function useMockData() {
      const mockUser = {
        id: 5922049376,
        first_name: 'Akram',
        last_name: 'Khezzari', 
        username: 'A_mja_d_0_5'
      };
      
      currentUser = mockUser;
      
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ù…Ù‡Ø§Ù…
      userTasks = {
        dailyTasks: JSON.parse(JSON.stringify(dailyTasksTemplates)),
        weeklyTasks: JSON.parse(JSON.stringify(weeklyTasksTemplates)),
        specialTasks: JSON.parse(JSON.stringify(specialTasksTemplates)),
        achievements: JSON.parse(JSON.stringify(achievementsTemplates))
      };
      
      // ØªØ­Ø¯ÙŠØ« Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ù„ØªØ¨Ø¯Ùˆ ÙˆÙƒØ£Ù†Ù‡Ø§ Ù…ÙƒØªÙ…Ù„Ø© Ø£Ùˆ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°
      userTasks.dailyTasks[0].status = 'completed';
      userTasks.dailyTasks[0].progress.current = 1;
      
      userTasks.dailyTasks[1].status = 'in-progress';
      userTasks.dailyTasks[1].progress.current = 1;
      
      userTasks.weeklyTasks[0].status = 'in-progress';
      userTasks.weeklyTasks[0].progress.current = 3;
      
      userTasks.achievements[0].status = 'unlocked';
      userTasks.achievements[1].status = 'unlocked';
      
      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      renderTaskList(userTasks.dailyTasks, 'dailyTasksList');
      renderTaskList(userTasks.weeklyTasks, 'weeklyTasksList');
      renderTaskList(userTasks.specialTasks, 'specialTasksList');
      renderAchievements();
    }

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ==========
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù…...');
      
      // ØªÙ‡ÙŠØ¦Ø© Telegram WebApp
      initializeTelegramWebApp();
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ
      document.querySelectorAll('.bottom-nav-item').forEach(item => {
        if (!item.hasAttribute('href')) {
          item.addEventListener('click', function(e) {
            e.preventDefault();
            const page = this.getAttribute('data-page');
            if (page === 'tasks') {
              // Ù†Ø­Ù† Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
              this.classList.add('active');
            }
          });
        }
      });
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      setTimeout(() => {
        showLoading(false);
      }, 2000);
    });
  </script>
</body>
</html>
